// This tailnet's policies are managed at https://github.com/ardenasasvc/automagic
{
	// Define the tags which can be applied to devices and by which users.
	"tagOwners": {
		"tag:lab":  ["ardenasasvc@github"],
		"tag:k8s-operator": [],
		"tag:k8s": ["tag:k8s-operator"],
	},

	"acls": [
		// allow myself access to everything
		{
			"action": "accept",
			"src":    ["ardenasasvc@github"],
			"dst":    ["*:*"],
		},
		// allow lab devices to talk to each other
		{
			"action": "accept",
			"src":    ["tag:lab"],
			"dst":    ["tag:lab:*"],
		},
		// devices running as the same user can communicate over ssh
		{
			"action": "accept",
			"src": ["*"],
			"dst": ["autogroup:self:22"],
		}
	],
	// Define users and devices that can use Tailscale SSH.
	"ssh": [
		// Allow all users to SSH into their own devices in check mode.
		{
			"action": "check",
			"src":    ["autogroup:members"],
			"dst":    ["autogroup:self"],
			"users":  ["autogroup:nonroot", "root"],
		}
	]
}
